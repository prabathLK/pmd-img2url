<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pmd-img2url - Dashboard</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; display: flex; flex-direction: column; align-items: center; min-height: 90vh; background: #1a1a1a; color: #eee; padding-top: 2rem; }
        .container { background: #2c2c2c; width: 90%; max-width: 600px; padding: 2rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.4); margin-bottom: 2rem; }
        h1 { text-align: center; color: #00aaff; margin-top: 0; }
        h2 { border-bottom: 1px solid #444; padding-bottom: 10px; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        .stat-box { background: #333; padding: 1.5rem; border-radius: 8px; text-align: center; }
        .stat-box h3 { margin: 0 0 10px 0; color: #00aaff; }
        .stat-box p { font-size: 2rem; font-weight: bold; margin: 0; color: #fff; }
        .uploader-box { margin-top: 1.5rem; }
        input[type="file"] { display: block; width: 100%; padding: 10px; margin-top: 1rem; color: #ccc; background: #444; border: 1px dashed #666; border-radius: 4px; box-sizing: border-box; }
        button { display: block; width: 100%; padding: 0.8rem; margin-top: 1.5rem; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 1rem; font-weight: bold; }
        button:hover { background: #0056b3; }
        .message { padding: 1rem; border-radius: 4px; margin-top: 1rem; text-align: center; }
        .message.success { background: #28a745; color: white; }
        .message.error { background: #dc3545; color: white; }
        .message a { color: white; font-weight: bold; text-decoration: underline; }
        footer { margin-top: auto; padding-bottom: 1rem; color: #777; font-size: 0.9rem; }
    </style>
</head>
<body>
    <div class="container">
        <h1>pmd-img2url</h1>
        <p style="text-align: center; margin-top: -10px; color: #999;">Image service for PRABATH-MD by Prabath Kumara</p>
        
        <h2>Live Statistics</h2>
        <div class="stats-grid">
            <div class="stat-box">
                <h3>Available Images</h3>
                <p id="stats-available">--</p>
            </div>
            <div class="stat-box">
                <h3>Auto-Deleted</h3>
                <p id="stats-deleted">--</p>
            </div>
            <div class="stat-box">
                <h3>Total Uploads</h3>
                <p id="stats-uploads">--</p>
            </div>
            <div class="stat-box">
                <h3>Total Views</h3>
                <p id="stats-views">--</p>
            </div>
        </div>

        <h2 style="margin-top: 2rem;">Upload Image</h2>
        <div class="uploader-box">
            <p>Select a new image (Max 2MB)</p>
            <form action="/upload" method="POST" enctype="multipart/form-data" id="upload-form">
                <input type="file" name="file" id="file-input" accept="image/*" required>
                <button type="submit" id="upload-button">Upload</button>
            </form>
            <div id="message-area"></div>
        </div>
    </div>

    <footer>
        Created by Prabath Kumara
    </footer>

    <script>
        async function fetchStats() {
            try {
                const response = await fetch('/stats');
                const data = await response.json();
                document.getElementById('stats-available').innerText = data.currentAvailable;
                document.getElementById('stats-deleted').innerText = data.totalDeletes;
                document.getElementById('stats-uploads').innerText = data.totalUploads;
                document.getElementById('stats-views').innerText = data.totalViews;
            } catch (err) {
                console.error('Failed to fetch stats');
            }
        }

        function showUploadMessage() {
            const urlParams = new URLSearchParams(window.location.search);
            const messageArea = document.getElementById('message-area');
            
            if (urlParams.has('success') && urlParams.has('url')) {
                const url = urlParams.get('url');
                messageArea.className = 'message success';
                messageArea.innerHTML = `Success! URL: <a href="${url}" target="_blank">${url}</a>`;
            } else if (urlParams.has('error')) {
                messageArea.className = 'message error';
                messageArea.innerText = urlParams.get('error');
            }
        }
        
        document.getElementById('upload-form').addEventListener('submit', () => {
             document.getElementById('upload-button').innerText = 'Uploading...';
             document.getElementById('upload-button').disabled = true;
        });

        document.getElementById('file-input').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file && file.size > 2 * 1024 * 1024) {
                 const messageArea = document.getElementById('message-area');
                 messageArea.className = 'message error';
                 messageArea.innerText = 'File is too large. Limit is 2MB.';
                 document.getElementById('upload-button').disabled = true;
            } else {
                 const messageArea = document.getElementById('message-area');
                 messageArea.innerHTML = '';
                 messageArea.className = '';
                 document.getElementById('upload-button').disabled = false;
            }
        });

        fetchStats();
        showUploadMessage();
    </script>
</body>
</html>
